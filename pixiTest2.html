<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://pixijs.download/release/pixi.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
    <script src="pfd.js"></script>
    
</head>



<body>
    <button onclick='requestOrientationPermission();'>Test20</button> <!-- Button zum request der permission um die Device orientierung zu lesen -->
    
    <script>
        pfd(); // TEST FUNKTIONSAUFRUF IN ANDERER DATEI
    
        var alpha = 888;  // Device orientation angle ALPHA
        var beta = 888;   // Device orientation angle BETA
        var gamma = 888;  // Device orientation angle GAMMA

        function requestOrientationPermission() { // Device orientierung lesen
        DeviceOrientationEvent.requestPermission()
            .then(response => {
            alert(response);
            if (response == 'granted') {
                window.addEventListener('deviceorientation', (event) => {
                alpha = event.alpha / 360;  // Lese winkel aus
                beta = event.beta / 360;  // Lese winkel aus
                gamma = event.gamma / 360;  // Lese winkel aus
                })
            }
            })
            .catch(console.error)
        }

        const app = new PIXI.Application({ antialias: true, background: '#000000', resizeTo: window });
        document.body.appendChild(app.view);

        // draw a shape for the PFD sky
        const skyShape = new PIXI.Graphics();
        skyShape.beginFill(0x285EF6); 
        skyShape.drawRect(0, 0, 800, 800);
        app.stage.addChild(skyShape);

        // draw Rect + Line for the PFD ground IN CONTAINER
        var groundShapeContainer = new PIXI.Container();
        var groundShape = new PIXI.Graphics();
        groundShape.beginFill(0x916130);
        groundShape.drawRect(-1000, -1000, 2000, 2000); // grosses quadrat fuer ground
        groundShapeContainer.addChild(groundShape);
        const horizLine = new PIXI.Graphics();
        horizLine.lineStyle(2, 0xFFFFFF, 1); // draw PFD Horizont Line
        horizLine.moveTo(-1000, -1000);
        horizLine.lineTo(2000, -1000);
        for (i = -3; i < 4; i++) {        
        horizLine.moveTo(-50, -i*50-1000); horizLine.lineTo(50, -i*50-1000);
        }
        groundShapeContainer.addChild(horizLine);
        groundShapeContainer.position.set(400, 400); // positioningung unter boresight (spaeter +- pitch)
        groundShapeContainer.pivot.x = 0; 
        groundShapeContainer.pivot.y = -1000; // Angelpunkt an Oberseite = boresight
        groundShapeContainer.rotation = 0; // spaeter roll (bank angle)
        app.stage.addChild(groundShapeContainer);

        const groundShapeMask = new PIXI.Graphics(); // Create a rectangular mark for the groundShape
        groundShapeMask.beginFill(0xFFFFFF);
        groundShapeMask.drawRect(0, 0, 800, 800); // Size for the whole PFD
        groundShapeMask.endFill();
        app.stage.addChild(groundShapeMask);
        groundShapeContainer.mask = groundShapeMask; // apply mask to the groundShapeContainer

        // draw a boresight shape
        const boresightShape = new PIXI.Graphics();
        boresightShape.beginFill(0x000000);
        boresightShape.lineStyle(2, 0xffffff, 1); 
        boresightShape.moveTo(400, 400);
        boresightShape.lineTo(400+150, 400+50);
        boresightShape.lineTo(400+100, 400+50);
        boresightShape.lineTo(400, 400);
        boresightShape.beginFill(0x000000);
        boresightShape.moveTo(400, 400);
        boresightShape.lineTo(400-150, 400+50);
        boresightShape.lineTo(400-100, 400+50);
        boresightShape.lineTo(400, 400);
        boresightShape.closePath();
        boresightShape.endFill();
        app.stage.addChild(boresightShape);

        // PFD text for IAS, ALT
        const airspeedTextStyle = new PIXI.TextStyle({
        fill: "#00ff00",
        fontFamily: "\"Courier New\", Courier, monospace",
        fontSize: 36,
        fontWeight: "bold"
        });
        const airspeedText = new PIXI.Text('124', airspeedTextStyle);
        airspeedText.text = '12345'; // TEST TEXT UPDATE
        airspeedText.x = 50;
        airspeedText.y = 380;
        app.stage.addChild(airspeedText);
        const altitudeText = new PIXI.Text('3000', airspeedTextStyle);
        altitudeText.x = 675;
        altitudeText.y = 380;
        app.stage.addChild(altitudeText);


        // Device orientierung als text ausgeben
        const orientationTextStyle = new PIXI.TextStyle({
        fill: "#00ff00",
        fontFamily: "\"Courier New\", Courier, monospace",
        fontSize: 36,
        fontWeight: "bold"
        });
        const alphaText = new PIXI.Text(alpha, orientationTextStyle);
        alphaText.x = 50;
        alphaText.y = 750;
        app.stage.addChild(alphaText);
        const betaText = new PIXI.Text(beta, orientationTextStyle);
        betaText.x = 150;
        betaText.y = 750;
        app.stage.addChild(betaText);
        const gammaText = new PIXI.Text(gamma, orientationTextStyle);
        gammaText.x = 250;
        gammaText.y = 750;
        app.stage.addChild(gammaText);


        // Listen for animate update
        var time = 0; // Simulationszeit
        var pitch = 5; // pitch angle
        var roll = 20; // pitch angle
     
        app.ticker.add((delta) =>
        {   time += delta/60;
            // console.log(time);
            pitch = 10*Math.sin(time/5) // Fake pitch angle   
            groundShapeContainer.position.set(400, 400 + pitch*10); // positioningung unter boresight +- pitch
            roll = Math.sin(time/3) /2; // Fake bank angle          
            groundShapeContainer.rotation = roll;
        
            alphaText.text = alpha; // update Text output for orientation angle\
            betaText.text = beta; // update Text output for orientation angle
            gammaText.text = gamma; // update Text output for orientation angle


        });

    </script>
</body>

</html>